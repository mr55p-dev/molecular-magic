# Molecular Magic

Working repository for modifications to the work done in https://github.com/sanha0213/MolE8
****
## Setup
- Run `conda env install -f environment.yml` to setup the environment.
- Run `conda activate molemagic` to setup the correct python binary
- Run `python3 raw_analysis/clean_database.py` to generate a cleaned database object
- Run `python3 raw_analysis/create_features.py` to generate feature matricese
- Run `python3 model_training/NN/NN.py` to run the neural network code (refactored by @mr55p-dev)
- Run `python3 model_training/NN/NN_original.py` to run the neural network code (original implementation from MolE8)

## Structure

- `feature_generation/` contains the source files for taking a `.plk` file and converting it into a saved numpy array `.npy` file
  - `clean_database.py` removes specific subsets of molecules based on calculated properties.
  - `create_features.py` calculates historgams and creates the vector representation.
- `model_training/` has the code for training models with the different configurations and experimental parameters. It references several files which correspond to modifications of the dataset, either in the cleaning or feature creation stages.
- `raw_analysis` is the code for taking the Gaussian16 output files for each molecule (one file for initial geometry, one for calculated geometry and energy, one for thermodynamic quantities) and parsing them into representation which is used by `feature_generation`. This is a really really inefficient process, and will probably be modified to keep only the relevant properties of each molecule saved as numeric or binary data.

## Requirements

`requirements.txt` is generated by `pipreqs`, as the development environment for an M1 mac with tensorflow is not exactly consistent with any other system.

## Openbabel

`openbabel` used in the project seems to be version `2.x.x` however this can't be verified due to no requirements file being included. Instead of using this it seems better to migrate to version `3.1.1` and moving forward take advantage of the `pybabel` API rather than the auto-generated C++ bindings. Some corrections which appear to be related to the version change are being made to the original code.

## Neural network models
`NN` now works correctly, see `NN_custom_splitting.py` for the reference implementation to circumvent the issue of the missing file. The issue is referenced in [#2](https://github.com/LukeRaw/molecular-magic/issues/2).
The base neural network will take $\approx 2\ \text{hours}$.

The only differnce between `NN` and `NN2` is the number of layers in the defined model. The code is identical.

## Kernel Ridge Regression models
Some of the `model_training/KRR` experiments fail, and this seems to be due to an address boundary error in `sklearn`. Exits with `SIGSEV: Address boundary error`. Also, half of the files save a fitted kernel and the other half load fitted kernels and there is NO NAMING CONVENTION to help out distinguishing the two. I have removed all but one of the files, since they are all basically the same anyway.

